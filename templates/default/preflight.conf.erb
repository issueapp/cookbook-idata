if ($request_method ~ ^OPTIONS$) {
    rewrite ^.*$ /__OPTIONS__ last;
} 

location = /__OPTIONS__ {
    if ($request_method != OPTIONS ) {
        return 405;
    } 
    add_header Access-Control-Allow-Origin $http_origin;
    add_header Access-Control-Allow-Methods "GET, OPTIONS, POST, PUT, DELETE";
    add_header Access-Control-Allow-Headers $http_access_control_request_headers;   
    add_header Access-Control-Allow-Credentials true;
    add_header Access-Control-Max-Age 1728000;
    add_header Content-Length 0;
    add_header Content-Type text/plain;
    return 204;
}   
